---
title: ""
author: ""
date: ""
output: 
  word_document:
    reference_docx: //deqhq1/WQNPS/Agriculture/Status_and_Trend_Analysis/R_support_files/Report_Template.docx
---



```{r setup, include=FALSE}

library(knitr)
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE, 
                      warning=FALSE, 
                      error = FALSE,
                      cache = FALSE,
                      results = 'hide',
                      include = TRUE)
library(RCurl)
library(plyr)
library(sp)
library(wq)
library(chron)
library(reshape)
library(ggplot2)
library(zoo)
library(dplyr)
library(lubridate)
library(base)
library(captioner)

tbls  <- captioner(prefix="**Table")
figs <- captioner(prefix="  \n**Figure")

```


```{r inputs, include=FALSE}

# agwqma, query_dates, and project_dir are different for every Report. Note 'agwqma' must be named exactly 
# how it is named in the agwqma shapefile ('agwqma_shp').
agwqma <- "Molalla-Pudding French Prairie North Santiam"
query_dates <- c("2000-01-01", "2018-03-01")
project_dir <- "//deqhq1/WQNPS/Agriculture/Status_and_Trend_Analysis/Molalla-Pudding French Prairie North Santiam/2018/StatusAndTrendsRMarkdown"

# Everything below here should not change
Rdata_dir <- paste0(project_dir,"/RData")
GIS_dir <- paste0(project_dir,"/GIS")

# Name of output files from main report
# These files should exist already
df_all_file <- paste0(gsub(" ", "_", agwqma), "_df_all_",paste(query_dates, collapse = "."), ".Rdata")
landuse_file <- paste0(gsub(" ", "_", agwqma), "_landuse.Rdata")
stns_file <- paste0(gsub(" ", "_", agwqma), "_stns.Rdata")
status_file <- paste0(gsub(" ", "_", agwqma), "_status.Rdata")
trend_file <- paste0(gsub(" ", "_", agwqma), "_trend.Rdata")
stns_param_summary_file <- paste0(gsub(" ", "_", agwqma), "_station_param_summary.Rdata")

```

```{r load-dataframes, include=FALSE}

load(paste0(Rdata_dir, "/", df_all_file))
load(paste0(Rdata_dir, "/", landuse_file))
load(paste0(Rdata_dir, "/", stns_file))
load(paste0(Rdata_dir, "/", status_file))
load(paste0(Rdata_dir, "/", trend_file))
load(paste0(Rdata_dir, "/", stns_param_summary_file))

```

# Executive Summary

## Purpose

The report presents data and analysis that will help DEQ fulfill its roles in the biennial review process described in the Memorandum of Agreement between ODA and DEQ.  This water quality status and trends report can be used to inform discussions between DEQ Basin Coordinators and ODA Agriculture Water Quality Specialists prior to the Local Advisory Committee meeting.  The discussions between DEQ and ODA prior to the LAC meeting could include: water quality and what's working and not working, source(s) and solutions, data needs and future monitoring to answer these questions. This report presents an analysis of water quality data readily accessible from public databases and available in sufficient quantity to indicate status and trends. DEQ will use available water quality data to answer the following questions: 

*	What is the status of water quality parameters? 
*	What is the trend in water quality? 
*	Are TMDL load allocations being met?
*	Can water quality status and trends be attributed to a source or sources?

## Methods

Water quality data were retrieved from DEQ, EPA and USGS databases. DEQ's volunteer monitoring database was not included, however some volunteer data is queried from EPA's database. Many organizations provided data used in this report (see Appendix). Data collected between `r format(ymd(query_dates[1]), format="%B %d, %Y")` to `r format(ymd(query_dates[2]), format="%B %d, %Y")` and only within the `r agwqma` agricultural water quality management area were included in this report. Parameters included in the data query were temperature, pH, dissolved oxygen, total suspended solids, total phosphorus, and bacteria (*E. coli*, fecal coliform, and *Enterococcus*). 

The data returned were evaluated for data qualit. Data included `r unique(df.all[df.all$Database == 'Element' | df.all$Database == 'LASAR', 'Status'])` data determined following the DEQ's Laboratory Quality Manual. EPA and USGS data were included unless result comments indicated problems with the data. Data was evaluated against the applicable Oregon water quality criterion.

## Land Use

Each monitoring station that fit the criteria to assess water quality status and/or trends was included in the land use analysis. The Stream-Catchment ([StreamCat](https://www.epa.gov/national-aquatic-resource-surveys/streamcat)) developed by EPA was used to summarize the cumulative upstream catchment of each station for primary land use characteristics, based on the National Hydrography Dataset Plus Version 2 geospatial framework.

```{r landuse-exec, results='asis'}

library(knitr)
library(dplyr)
library(plyr)

stn_to_use <-c(unique(stns$Station_ID))

knitr::kable(landuse, digits = 0, padding = 2, caption = tbls(name = "landUse", caption = "Summary table of watershed land use by station, only stations which have at least 8 years of yearly data (between 2000 and 2017) and/or are used to evaluate last known status.**"))

```

## Results Summary

`r length(unique(stn_to_use))` monitoring stations contained sufficient data to assess status and/or trends out of `r length(unique(df.all$Station_ID))` total monitoring stations within the `r agwqma` AgWQ Management Area 


Analyte         | Number of stations w/ sufficent data for status analysis | Number of stations w/ sufficent data for trend analysis
----------------|----------------------------------------------------- | ----------------------------------------------------
Bacteria        | `r nrow(unique(status[status$Analyte == "E. Coli", ]))` | `r nrow(unique(trend[trend$Analyte == "E. Coli", ]))`
Temperature     | `r nrow(unique(status[status$Analyte == "Temperature", ]))` | `r nrow(unique(trend[trend$Analyte == "Temperature", ]))`
Dissolved Oxygen| `r nrow(unique(status[status$Analyte == "Dissolved Oxygen", ]))` | `r nrow(unique(trend[trend$Analyte == "Dissolved Oxygen", ]))`
pH              | `r nrow(unique(status[status$Analyte == "pH", ]))` | `r nrow(unique(trend[trend$Analyte == "pH",]))`
TSS             | `r nrow(unique(status[status$Analyte == "Total Suspended Solids", ]))` | `r nrow(unique(trend[trend$Analyte == "Total Suspended Solids", ]))`
Total Phosphorus| `r nrow(unique(status[status$Analyte == "Total Phosphorus", ]))` | `r nrow(unique(trend[trend$Analyte == "Total Phosphorus", ]))`

```{r parm-summary-table}

knitr::kable(stns_param_summary, digits = 3, caption = "Summary of Monitoring Stations Status and Trend, where 'exceed' represents a single exceedance of the water quality standard within the last two years of available data. Note: DO = dissolved oxygen")

```
